<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jogo: Simulador de Rota | BeeWay</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <style>
    :root {
        --game-bg: #f8f9fa;
        --game-border: #dee2e6;
        --game-shadow: rgba(0,0,0,0.07);
        --correct-color: #2a9d8f;
        --incorrect-color: #e76f51;
        --game-dark-blue: #1D3557;
    }

    .route-simulator-wrapper {
        background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-top: 40px;
        text-align: center;
    }

    .game-screen { display: none; animation: fadeIn 0.5s ease-in-out; }
    .game-screen.active { display: block; }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .game-title h2 { font-size: 2rem; margin-bottom: 10px; }
    .game-title p, #start-screen p { color: var(--secondary-text); max-width: 600px; margin: 0 auto 30px; }

    .game-button {
      background-color: var(--primary-yellow);
      color: var(--dark-text); font-weight: 600; padding: 15px 30px; border-radius: 50px;
      display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 183, 3, 0.4); border: none; cursor: pointer; font-size: 1.1rem;
    }
    .game-button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255, 183, 3, 0.5); }
    .end-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }

    #game-layout {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        text-align: left;
    }

    #map-container {
        flex: 3;
        background-color: #fff;
        border-radius: 8px;
        border: 1px solid var(--game-border);
        box-shadow: 0 2px 10px var(--game-shadow);
        aspect-ratio: 4 / 3;
        position: relative;
    }

    #map-svg { width: 100%; height: 100%; }
    .delivery-point { cursor: pointer; transition: all 0.2s ease; }
    .delivery-point:hover { r: 12; }
    .depot { font-size: 24px; }
    .route-line { stroke: var(--primary-orange); stroke-width: 3; stroke-dasharray: 5; animation: draw-line 0.5s linear; }
    @keyframes draw-line { from { stroke-dashoffset: 1000; } to { stroke-dashoffset: 0; } }

    #stats-panel {
        flex: 1;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px var(--game-shadow);
    }
    #stats-panel h3 { font-size: 1.3rem; margin-bottom: 15px; border-bottom: 2px solid var(--primary-yellow); padding-bottom: 10px; }
    .stat-item { margin-bottom: 15px; font-size: 1rem; }
    .stat-item span { font-weight: 700; color: var(--game-dark-blue); }

    #end-screen h3 { font-size: 1.8rem; margin-bottom: 15px; }
    .results-comparison { display: flex; justify-content: space-around; gap: 20px; margin: 20px 0; }
    .result-box { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px var(--game-shadow); flex: 1; }
    .result-box h4 { font-size: 1.1rem; color: var(--secondary-text); }
    .result-box p { font-size: 1.5rem; font-weight: 700; }
    #final-efficiency { font-size: 1.3rem; margin: 20px 0; }
    #final-efficiency.excellent { color: var(--correct-color); }
    #final-efficiency.good { color: var(--primary-orange); }
    #final-efficiency.inefficient { color: var(--incorrect-color); }

    .educational-note {
        margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--game-border);
        font-style: italic; color: var(--secondary-text);
    }
    
    @media (max-width: 768px) {
        #game-layout { flex-direction: column; }
        .route-simulator-wrapper { padding: 20px; }
        .results-comparison { flex-direction: column; }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="container">
      <a href="index.html" class="logo-container">
        <svg class="logo-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 5L95.5 27.5V72.5L50 95L4.5 72.5V27.5L50 5Z" fill="#FFB703"/>
            <path d="M50 5L4.5 27.5V72.5L50 95L95.5 72.5V27.5L50 5Z" stroke="#212529" strokeWidth="4"/>
            <path d="M50 50L4.5 27.5" stroke="#212529" strokeWidth="4"/>
            <path d="M50 50L50 5" stroke="#212529" strokeWidth="4"/>
            <path d="M50 50L95.5 27.5" stroke="#212529" strokeWidth="4"/>
        </svg>
        <div class="logo-text"> <h1>BeeWay</h1> </div>
      </a>
      <button class="mobile-menu-toggle" aria-label="Abrir menu" aria-expanded="false" aria-controls="mainNav">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
      </button>
      <nav class="main-nav" id="mainNav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="conteudos.html" class="nav-link">Conte√∫dos</a>
        <a href="jogos.html" class="nav-link active">Jogos</a>
        <a href="sobre.html" class="nav-link">Sobre n√≥s</a>
        <a href="recebimento-materiais.html" class="nav-link">Recebimento</a>
        <a href="contato.html" class="nav-link">Contato</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container article-page" style="padding-top: 40px;">
      <div class="route-simulator-wrapper">

        <div id="start-screen" class="game-screen active">
            <div class="game-title">
                <h2>Simulador de Rota / Entregas</h2>
                <p>Clique nos pontos de entrega no mapa para criar sua rota, come√ßando pelo dep√≥sito. Quando todos os pontos forem visitados, sua rota ser√° analisada. Crie o caminho mais eficiente!</p>
            </div>
            <button id="start-button" class="game-button">‚ñ∂Ô∏è Iniciar Jogo</button>
        </div>

        <div id="game-play-screen" class="game-screen">
            <div id="game-layout">
                <div id="map-container">
                    <svg id="map-svg" viewBox="0 0 800 600"></svg>
                </div>
                <div id="stats-panel">
                    <h3>Resumo da Rota</h3>
                    <div class="stat-item">Dist√¢ncia: <span id="distance-value">0 km</span></div>
                    <div class="stat-item">Tempo: <span id="time-value">0 h</span></div>
                    <div class="stat-item">Custo: <span id="cost-value">R$ 0,00</span></div>
                    <div class="stat-item">Entregas restantes: <span id="remaining-value">5</span></div>
                </div>
            </div>
        </div>

        <div id="end-screen" class="game-screen">
            <h3>An√°lise da Rota</h3>
            <div class="results-comparison">
                <div class="result-box">
                    <h4>Sua Rota</h4>
                    <p id="user-distance">0 km</p>
                </div>
                <div class="result-box">
                    <h4>Rota Otimizada</h4>
                    <p id="optimal-distance">0 km</p>
                </div>
            </div>
            <h4 id="final-efficiency"></h4>
            <div class="educational-note">
                <p>Na log√≠stica, planejar rotas otimizadas √© essencial para reduzir custos, economizar combust√≠vel e garantir entregas pontuais.</p>
            </div>
            <div class="end-buttons">
                <button id="replay-button" class="game-button">üîÅ Tentar Novamente</button>
                <a href="jogos.html" class="game-button">‚¨ÖÔ∏è Voltar ao Menu</a>
            </div>
        </div>

      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2024 BeeWay ‚Äî Simplificando a log√≠stica para voc√™.</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuToggle = document.querySelector('.mobile-menu-toggle');
        const mainNav = document.getElementById('mainNav');
        if (menuToggle && mainNav) {
            menuToggle.addEventListener('click', () => {
                const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                menuToggle.setAttribute('aria-expanded', !isExpanded);
                mainNav.classList.toggle('mobile-nav-open');
            });
        }
        
        // --- GAME LOGIC ---
        const startScreen = document.getElementById('start-screen');
        const gamePlayScreen = document.getElementById('game-play-screen');
        const endScreen = document.getElementById('end-screen');
        const startButton = document.getElementById('start-button');
        const replayButton = document.getElementById('replay-button');
        const mapSvg = document.getElementById('map-svg');
        const distanceVal = document.getElementById('distance-value');
        const timeVal = document.getElementById('time-value');
        const costVal = document.getElementById('cost-value');
        const remainingVal = document.getElementById('remaining-value');
        
        const NUM_POINTS = 5;
        const SVG_NS = "http://www.w3.org/2000/svg";

        let points = [];
        let userRoute = [];
        let optimalRouteDistance = 0;
        let audioCtx;
        
        const playSound = (type) => {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            
            if (type === 'click') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
            } else if (type === 'success') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
            }
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.4);
        };

        const switchScreen = (screen) => {
            document.querySelectorAll('.game-screen').forEach(s => s.classList.remove('active'));
            screen.classList.add('active');
        };

        const startGame = () => {
            generatePoints();
            calculateOptimalRoute();
            userRoute = [points[0]]; // Start at the depot
            drawGame();
            updateStats();
            switchScreen(gamePlayScreen);
        };

        const generatePoints = () => {
            points = [];
            const width = 800;
            const height = 600;
            const padding = 50;

            // Depot
            points.push({ x: padding, y: height / 2, id: 0, visited: true });

            while (points.length < NUM_POINTS + 1) {
                const newPoint = {
                    x: Math.random() * (width - 2 * padding) + padding,
                    y: Math.random() * (height - 2 * padding) + padding,
                    id: points.length,
                    visited: false,
                };

                let tooClose = false;
                for (const p of points) {
                    if (getDistance(p, newPoint) < 100) {
                        tooClose = true;
                        break;
                    }
                }
                if (!tooClose) {
                    points.push(newPoint);
                }
            }
        };
        
        const getDistance = (p1, p2) => Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));

        const calculateOptimalRoute = () => {
            let unvisited = [...points.slice(1)];
            let currentPoint = points[0];
            let distance = 0;
            
            while(unvisited.length > 0) {
                unvisited.sort((a, b) => getDistance(currentPoint, a) - getDistance(currentPoint, b));
                let nextPoint = unvisited.shift();
                distance += getDistance(currentPoint, nextPoint);
                currentPoint = nextPoint;
            }
            distance += getDistance(currentPoint, points[0]); // Return to depot
            optimalRouteDistance = distance;
        };

        const drawGame = () => {
            mapSvg.innerHTML = '';
            
            // Draw lines
            for (let i = 0; i < userRoute.length - 1; i++) {
                const line = document.createElementNS(SVG_NS, 'line');
                line.setAttribute('x1', userRoute[i].x);
                line.setAttribute('y1', userRoute[i].y);
                line.setAttribute('x2', userRoute[i+1].x);
                line.setAttribute('y2', userRoute[i+1].y);
                line.classList.add('route-line');
                mapSvg.appendChild(line);
            }

            // Draw points
            points.forEach((p, index) => {
                if (index === 0) { // Depot
                    const text = document.createElementNS(SVG_NS, 'text');
                    text.setAttribute('x', p.x - 12);
                    text.setAttribute('y', p.y + 10);
                    text.textContent = 'üöö';
                    text.classList.add('depot');
                    mapSvg.appendChild(text);
                } else {
                    const circle = document.createElementNS(SVG_NS, 'circle');
                    circle.setAttribute('cx', p.x);
                    circle.setAttribute('cy', p.y);
                    circle.setAttribute('r', userRoute.includes(p) ? 8 : 10);
                    circle.setAttribute('fill', userRoute.includes(p) ? '#6c757d' : '#FFB703');
                    circle.setAttribute('stroke', '#212529');
                    circle.setAttribute('stroke-width', 2);
                    circle.classList.add('delivery-point');
                    if (!userRoute.includes(p)) {
                        circle.onclick = () => selectPoint(p);
                    }
                    mapSvg.appendChild(circle);
                }
            });
        };

        const selectPoint = (point) => {
            playSound('click');
            userRoute.push(point);
            drawGame();
            updateStats();

            if (userRoute.length === points.length) {
                setTimeout(endGame, 500);
            }
        };

        const updateStats = () => {
            let distance = 0;
            for (let i = 0; i < userRoute.length - 1; i++) {
                distance += getDistance(userRoute[i], userRoute[i+1]);
            }
            
            const remaining = NUM_POINTS - (userRoute.length - 1);
            const time = distance / 80; // Assuming 80km/h avg
            const cost = (distance / 10) * 5.5; // 10km/L, R$5.50/L

            distanceVal.textContent = `${Math.round(distance)} km`;
            timeVal.textContent = `${time.toFixed(1)} h`;
            costVal.textContent = `R$ ${cost.toFixed(2)}`;
            remainingVal.textContent = remaining;
        };

        const endGame = () => {
            playSound('success');
            let userDistance = 0;
            for (let i = 0; i < userRoute.length - 1; i++) {
                userDistance += getDistance(userRoute[i], userRoute[i+1]);
            }
            userDistance += getDistance(userRoute[userRoute.length - 1], points[0]); // Return to depot

            document.getElementById('user-distance').textContent = `${Math.round(userDistance)} km`;
            document.getElementById('optimal-distance').textContent = `${Math.round(optimalRouteDistance)} km`;

            const efficiency = userDistance / optimalRouteDistance;
            const finalEfficiencyEl = document.getElementById('final-efficiency');
            finalEfficiencyEl.className = '';
            
            if (efficiency < 1.1) {
                finalEfficiencyEl.textContent = 'üü¢ Rota otimizada! Voc√™ economizou tempo e combust√≠vel.';
                finalEfficiencyEl.classList.add('excellent');
            } else if (efficiency < 1.3) {
                finalEfficiencyEl.textContent = 'üü° Boa rota, mas pode melhorar.';
                finalEfficiencyEl.classList.add('good');
            } else {
                finalEfficiencyEl.textContent = 'üî¥ Ineficiente! Custos altos e atrasos.';
                finalEfficiencyEl.classList.add('inefficient');
            }
            switchScreen(endScreen);
        };

        startButton.addEventListener('click', startGame);
        replayButton.addEventListener('click', startGame);
    });
  </script>

</body>
</html>